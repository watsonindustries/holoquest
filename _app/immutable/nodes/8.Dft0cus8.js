import{s as te,o as se,a as ae}from"../chunks/scheduler.-y_xNphp.js";import{S as ne,i as oe,e as g,s as P,u as L,t as M,c as v,f as R,g as Q,b,v as F,j as B,d as N,l as d,w as x,n as re,m as o,x as W,o as le,p as ie,y as Y,z as J,A as K}from"../chunks/index.tFPaMmG2.js";import{e as ce}from"../chunks/qr-scanner.min.4zogFLvw.js";import{I as X,S as Z,Q as ee,T as me,t as ue,g as de,s as pe,a as fe}from"../chunks/index.DlS5U7n5.js";import{S as r,T as I}from"../chunks/custom.DgUHssZa.js";import{s as w}from"../chunks/toasts.r9iJ3d1v.js";import{m as he}from"../chunks/const.CGFi_4Hk.js";function Se(i){let e,l,f="Scanner",p,n,y="Press Scan, and scan the QR code of the stamp!",E,c,t,m,A,T=i[0]===r.SCANNING?"Stop":"Scan",D,k,u,U="<video></video>",G,C,h,_,V,S,z,j;return m=new X({props:{src:i[0]===r.SCANNING?Z:ee,theme:"solid",class:"color-gray-900",size:"32px"}}),_=new X({props:{src:me,theme:"solid",class:"color-gray-900",size:"28px"}}),{c(){e=g("div"),l=g("h1"),l.textContent=f,p=P(),n=g("p"),n.textContent=y,E=P(),c=g("div"),t=g("button"),L(m.$$.fragment),A=P(),D=M(T),k=P(),u=g("div"),u.innerHTML=U,G=P(),C=g("div"),h=g("a"),L(_.$$.fragment),V=M(`
			View collected stamps`),this.h()},l(a){e=v(a,"DIV",{class:!0});var s=R(e);l=v(s,"H1",{class:!0,"data-svelte-h":!0}),Q(l)!=="svelte-eclbcz"&&(l.textContent=f),p=b(s),n=v(s,"P",{class:!0,"data-svelte-h":!0}),Q(n)!=="svelte-1a2fql6"&&(n.textContent=y),E=b(s),c=v(s,"DIV",{class:!0});var $=R(c);t=v($,"BUTTON",{class:!0});var O=R(t);F(m.$$.fragment,O),A=b(O),D=B(O,T),O.forEach(N),$.forEach(N),k=b(s),u=v(s,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),Q(u)!=="svelte-kz9i92"&&(u.innerHTML=U),G=b(s),C=v(s,"DIV",{class:!0});var q=R(C);h=v(q,"A",{class:!0,href:!0});var H=R(h);F(_.$$.fragment,H),V=B(H,`
			View collected stamps`),H.forEach(N),q.forEach(N),s.forEach(N),this.h()},h(){d(l,"class","text-center font-geologica text-4xl font-bold text-primary"),d(n,"class","px-2 text-center text-xl"),d(t,"class","text btn mx-auto w-10/12 max-w-screen-lg gap-2 rounded-full text-white"),x(t,"btn-primary",i[0]===r.STOPPED),x(t,"btn-error",i[0]===r.SCANNING),d(c,"class","flex flex-col justify-center space-y-4"),d(u,"id","scanner-preview-area"),d(u,"class","h-96"),x(u,"hidden",i[0]===r.STOPPED),d(h,"class","text btn-secondary btn mx-auto mt-2 w-10/12 max-w-screen-lg gap-2 rounded-full text-white"),d(h,"href","/"),d(C,"class","flex flex-col justify-center space-y-4"),d(e,"class","space-y-4")},m(a,s){re(a,e,s),o(e,l),o(e,p),o(e,n),o(e,E),o(e,c),o(c,t),W(m,t,null),o(t,A),o(t,D),o(e,k),o(e,u),o(e,G),o(e,C),o(C,h),W(_,h,null),o(h,V),S=!0,z||(j=le(t,"click",i[1]),z=!0)},p(a,[s]){const $={};s&1&&($.src=a[0]===r.SCANNING?Z:ee),m.$set($),(!S||s&1)&&T!==(T=a[0]===r.SCANNING?"Stop":"Scan")&&ie(D,T),(!S||s&1)&&x(t,"btn-primary",a[0]===r.STOPPED),(!S||s&1)&&x(t,"btn-error",a[0]===r.SCANNING),(!S||s&1)&&x(u,"hidden",a[0]===r.STOPPED)},i(a){S||(Y(m.$$.fragment,a),Y(_.$$.fragment,a),S=!0)},o(a){J(m.$$.fragment,a),J(_.$$.fragment,a),S=!1},d(a){a&&N(e),K(m),K(_),z=!1,j()}}}function ge(i){const e=new URL(i);if(e.pathname.startsWith("/sc/"))return e.pathname.substring(4);throw new Error("Invalid QR code")}function ve(i,e,l){let f="STOPPED",p,n;function y(){f===r.SCANNING?(l(0,f=r.STOPPED),n.pause()):f===r.STOPPED&&(l(0,f=r.SCANNING),n.start().catch(c=>{console.error(c),w({type:I.ERROR,message:"Failed to start scanner!"})}))}function E(c){let t="";try{t=ge(c.data),console.log("Scanned token:",t)}catch{w({type:I.ERROR,message:"Invalid QR code!"});return}y();let m=ue(t);de().includes(m)?(pe(t),w({type:I.SUCCESS,message:"Stamp Saved!"}),fe()>=he&&setTimeout(()=>{w({type:I.SUCCESS,message:"Stamp Rally completed!"})},1e3)):w({type:I.ERROR,message:"Invalid Stamp!"})}return se(()=>{p=document.querySelector("video"),n=new ce(p,E,{highlightScanRegion:!0,highlightCodeOutline:!0}),p.setAttribute("playsinline","true"),p.setAttribute("autoplay","true"),p.setAttribute("muted","true")}),ae(()=>{console.log("Destroying Scanner"),n==null||n.destroy()}),[f,y]}class $e extends ne{constructor(e){super(),oe(this,e,ve,Se,te,{})}}export{$e as component};
