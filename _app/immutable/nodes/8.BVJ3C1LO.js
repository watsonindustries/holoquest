import{s as _,n as x,o as P,a as O}from"../chunks/scheduler.BFm2QQji.js";import{S as D,i as A,e as g,s as R,c as v,f as N,g as C,b as y,d as E,l as u,u as T,n as b,m as h}from"../chunks/index.BRjTsfqn.js";import{e as k}from"../chunks/qr-scanner.min.4zogFLvw.js";import{t as I,g as w,s as H,a as q}from"../chunks/stamps.CTP00fdk.js";import{S as c,T as S}from"../chunks/custom.DgUHssZa.js";import{s as f}from"../chunks/toasts.BxjjKmbh.js";import{m as L}from"../chunks/const.CGFi_4Hk.js";import{g as M}from"../chunks/entry.CCekffdN.js";function Q(d){let e,a,i="Scanner",o,t,m="Press Scan, and scan the QR code of the stamp!",p,s,l="<video></video>";return{c(){e=g("div"),a=g("h1"),a.textContent=i,o=R(),t=g("p"),t.textContent=m,p=R(),s=g("div"),s.innerHTML=l,this.h()},l(r){e=v(r,"DIV",{class:!0});var n=N(e);a=v(n,"H1",{class:!0,"data-svelte-h":!0}),C(a)!=="svelte-eclbcz"&&(a.textContent=i),o=y(n),t=v(n,"P",{class:!0,"data-svelte-h":!0}),C(t)!=="svelte-1a2fql6"&&(t.textContent=m),p=y(n),s=v(n,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),C(s)!=="svelte-kz9i92"&&(s.innerHTML=l),n.forEach(E),this.h()},h(){u(a,"class","text-center font-geologica text-4xl font-bold text-primary"),u(t,"class","px-2 text-center text-xl"),u(s,"id","scanner-preview-area"),u(s,"class","h-96"),T(s,"hidden",d[0]===c.STOPPED),u(e,"class","space-y-4")},m(r,n){b(r,e,n),h(e,a),h(e,o),h(e,t),h(e,p),h(e,s)},p(r,[n]){n&1&&T(s,"hidden",r[0]===c.STOPPED)},i:x,o:x,d(r){r&&E(e)}}}function U(d){const e=new URL(d);if(e.pathname.startsWith("/sc/"))return e.pathname.substring(4);throw new Error("Invalid QR code")}function z(d,e,a){let i="STOPPED",o,t;function m(){i===c.SCANNING?(a(0,i=c.STOPPED),t.pause()):i===c.STOPPED&&(a(0,i=c.SCANNING),t.start().catch(s=>{console.error(s),f({type:S.ERROR,message:"Failed to start scanner!"})}))}function p(s){let l="";try{l=U(s.data),console.log("Scanned token:",l)}catch{f({type:S.ERROR,message:"Invalid QR code!"})}m();let r=I(l);w().includes(r)?(H(l),f({type:S.SUCCESS,message:"Stamp Saved!"}),q()>=L&&setTimeout(()=>{f({type:S.SUCCESS,message:"Stamp Rally completed!"})},1e3)):f({type:S.ERROR,message:"Invalid Stamp!"}),M("/")}return P(()=>{o=document.querySelector("video"),t=new k(o,p,{highlightScanRegion:!0,highlightCodeOutline:!0}),o.setAttribute("playsinline","true"),o.setAttribute("autoplay","true"),o.setAttribute("muted","true"),m()}),O(()=>{console.log("Destroying Scanner"),t==null||t.destroy()}),[i]}class J extends D{constructor(e){super(),A(this,e,z,Q,_,{})}}export{J as component};
