import{s as oe,a as F,o as le,b as ie}from"../chunks/scheduler.COW4diEM.js";import{S as ce,i as de,e as v,s as P,v as W,t as Y,c as _,f as R,g as j,b as I,w as J,j as K,d as x,l as u,x as y,n as me,m as r,y as X,o as ue,p as fe,z as Z,A as ee,B as te,C as se,u as pe}from"../chunks/index.B5o7o_bp.js";import{e as he}from"../chunks/qr-scanner.min.4zogFLvw.js";import{I as ae,S as ne,Q as re,T as Se,t as ge,g as ve,s as _e,a as Ce}from"../chunks/index.DSiUwQY9.js";import{S as o,T as w}from"../chunks/custom.DgUHssZa.js";import{f as q}from"../chunks/index.diNOV6nI.js";import{s as A}from"../chunks/toasts.Bpo-gSte.js";import{m as Ne}from"../chunks/const.CGFi_4Hk.js";function xe(c){let e,i,h="Scanner",f,n,E="Press Scan, and scan the QR code of the stamp!",T,d,t,m,D,b=c[0]===o.SCANNING?"Stop":"Scan",O,G,l,L="<video></video>",S,V,N,g,C,H,Q,p,z,M;return m=new ae({props:{src:c[0]===o.SCANNING?ne:re,theme:"solid",class:"color-gray-900",size:"32px"}}),C=new ae({props:{src:Se,theme:"solid",class:"color-gray-900",size:"28px"}}),{c(){e=v("div"),i=v("h1"),i.textContent=h,f=P(),n=v("p"),n.textContent=E,T=P(),d=v("div"),t=v("button"),W(m.$$.fragment),D=P(),O=Y(b),G=P(),l=v("div"),l.innerHTML=L,V=P(),N=v("div"),g=v("a"),W(C.$$.fragment),H=Y(`
			View collected stamps`),this.h()},l(s){e=_(s,"DIV",{class:!0});var a=R(e);i=_(a,"H1",{class:!0,"data-svelte-h":!0}),j(i)!=="svelte-eclbcz"&&(i.textContent=h),f=I(a),n=_(a,"P",{class:!0,"data-svelte-h":!0}),j(n)!=="svelte-1a2fql6"&&(n.textContent=E),T=I(a),d=_(a,"DIV",{class:!0});var $=R(d);t=_($,"BUTTON",{class:!0});var k=R(t);J(m.$$.fragment,k),D=I(k),O=K(k,b),k.forEach(x),$.forEach(x),G=I(a),l=_(a,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),j(l)!=="svelte-12nsnig"&&(l.innerHTML=L),V=I(a),N=_(a,"DIV",{class:!0});var B=R(N);g=_(B,"A",{class:!0,href:!0});var U=R(g);J(C.$$.fragment,U),H=K(U,`
			View collected stamps`),U.forEach(x),B.forEach(x),a.forEach(x),this.h()},h(){u(i,"class","text-center font-geologica text-4xl font-bold text-primary"),u(n,"class","px-2 text-center text-xl"),u(t,"class","text btn mx-auto w-10/12 max-w-screen-lg gap-2 rounded-full text-white"),y(t,"btn-primary",c[0]===o.STOPPED),y(t,"btn-error",c[0]===o.SCANNING),u(d,"class","flex flex-col justify-center space-y-4"),u(l,"id","scanner-preview-area"),u(l,"class","h-96"),y(l,"hidden",c[0]===o.STOPPED),u(g,"class","text btn-secondary btn mx-auto mt-2 w-10/12 max-w-screen-lg gap-2 rounded-full text-white"),u(g,"href","/"),u(N,"class","flex flex-col justify-center space-y-4"),u(e,"class","space-y-4")},m(s,a){me(s,e,a),r(e,i),r(e,f),r(e,n),r(e,T),r(e,d),r(d,t),X(m,t,null),r(t,D),r(t,O),r(e,G),r(e,l),r(e,V),r(e,N),r(N,g),X(C,g,null),r(g,H),p=!0,z||(M=ue(t,"click",c[1]),z=!0)},p(s,[a]){const $={};a&1&&($.src=s[0]===o.SCANNING?ne:re),m.$set($),(!p||a&1)&&b!==(b=s[0]===o.SCANNING?"Stop":"Scan")&&fe(O,b),(!p||a&1)&&y(t,"btn-primary",s[0]===o.STOPPED),(!p||a&1)&&y(t,"btn-error",s[0]===o.SCANNING),(!p||a&1)&&y(l,"hidden",s[0]===o.STOPPED)},i(s){p||(Z(m.$$.fragment,s),F(()=>{p&&(S||(S=te(l,q,{},!0)),S.run(1))}),Z(C.$$.fragment,s),Q||F(()=>{Q=pe(e,q,{delay:500}),Q.start()}),p=!0)},o(s){ee(m.$$.fragment,s),S||(S=te(l,q,{},!1)),S.run(0),ee(C.$$.fragment,s),p=!1},d(s){s&&x(e),se(m),s&&S&&S.end(),se(C),z=!1,M()}}}function ye(c){const e=new URL(c);if(e.pathname.startsWith("/sc/"))return e.pathname.substring(4);throw new Error("Invalid QR code")}function Ee(c,e,i){let h="STOPPED",f,n;function E(){h===o.SCANNING?(i(0,h=o.STOPPED),n.pause()):h===o.STOPPED&&(i(0,h=o.SCANNING),n.start().catch(d=>{console.error(d),A({type:w.ERROR,message:"Failed to start scanner!"})}))}function T(d){let t="";try{t=ye(d.data),console.log("Scanned token:",t)}catch{A({type:w.ERROR,message:"Invalid QR code!"});return}E();let m=ge(t);ve().includes(m)?(_e(t),A({type:w.SUCCESS,message:"Stamp Saved!"}),Ce()>=Ne&&setTimeout(()=>{A({type:w.SUCCESS,message:"Stamp Rally completed!"})},1e3)):A({type:w.ERROR,message:"Invalid Stamp!"})}return le(()=>{f=document.querySelector("video"),n=new he(f,T,{highlightScanRegion:!0,highlightCodeOutline:!0}),f.setAttribute("playsinline","true"),f.setAttribute("autoplay","true"),f.setAttribute("muted","true")}),ie(()=>{console.log("Destroying Scanner"),n==null||n.destroy()}),[h,E]}class De extends ce{constructor(e){super(),de(this,e,Ee,xe,oe,{})}}export{De as component};
